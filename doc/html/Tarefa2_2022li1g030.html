<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Tarefa2_2022li1g030</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption empty">&nbsp;</span><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Ana S&#225; Oliveira &lt;a104437@alunos.uminho.pt&gt;<br />Sara Campos Ramalho &lt;a72481@alunos.uminho.pt&gt;</td></tr><tr><th>Safe Haskell</th><td>Safe</td></tr></table><p class="caption">Tarefa2_2022li1g030</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Fun&#231;&#227;o estendeMapa</a><ul><li><a href="#g:2">Fun&#231;&#245;es principais</a></li><li><a href="#g:3">Fun&#231;&#245;es auxiliares</a></li></ul></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>M&#243;dulo para a realiza&#231;&#227;o da Tarefa 2 do projeto de LI1 em 2022/23.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:gera">gera</a> :: Int -&gt; Int -&gt; [Int]</li><li class="src short"><a href="#v:estendeMapa">estendeMapa</a> :: <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a> -&gt; Int -&gt; <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a></li><li class="src short"><a href="#v:proximosTerrenosValidos">proximosTerrenosValidos</a> :: <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a> -&gt; [<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>]</li><li class="src short"><a href="#v:geraTerreno">geraTerreno</a> :: Int -&gt; [<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>] -&gt; <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a></li><li class="src short"><a href="#v:rioAnterior">rioAnterior</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; Bool</li><li class="src short"><a href="#v:velocRioAnterior">velocRioAnterior</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a></li><li class="src short"><a href="#v:geraVelocidade">geraVelocidade</a> :: Int -&gt; [<a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a>] -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a></li><li class="src short"><a href="#v:adicionaVelocidade">adicionaVelocidade</a> :: <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a> -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a> -&gt; <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a></li><li class="src short"><a href="#v:proximosObstaculosValidos">proximosObstaculosValidos</a> :: Int -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]</li><li class="src short"><a href="#v:contaExtremos">contaExtremos</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; <a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a> -&gt; Int</li><li class="src short"><a href="#v:geraObstaculo">geraObstaculo</a> :: [Int] -&gt; Int -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Fun&#231;&#227;o estendeMapa</h1></a><a href="#g:2" id="g:2"><h2>Fun&#231;&#245;es principais</h2></a><div class="top"><p class="src"><a id="v:gera" class="def">gera</a> :: Int -&gt; Int -&gt; [Int] <a href="#v:gera" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:gera" title="Tarefa2_2022li1g030">gera</a></code> devolve n&#250;meros inteiros aleatoriamente, para serem utilizados em fun&#231;&#245;es posteriores de modo a criar aleatoriedade na cria&#231;&#227;o das novas linhas do mapa.</p><pre>gera seed n = take n $ randoms (mkStdGen seed)
</pre></div></div><div class="top"><p class="src"><a id="v:estendeMapa" class="def">estendeMapa</a> :: <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a> -&gt; Int -&gt; <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a> <a href="#v:estendeMapa" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:estendeMapa" title="Tarefa2_2022li1g030">estendeMapa</a></code> gera e acrescenta uma nova linha v&#225;lida no topo de um dado mapa, de largura <code>n</code> e composto pela lista <code>l</code>, em que cada elemento <code>(Terreno, [Obstaculos])</code> representa uma linha do mapa.</p><p>No caso de ainda n&#227;o existir nenhuma linha no mapa, isto &#233;, l = [], a fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:estendeMapa" title="Tarefa2_2022li1g030">estendeMapa</a></code> gera a primeira linha.</p><p>O argumento <code>seed</code> &#233; um inteiro aleat&#243;rio (no intervalo <code>[0, 100]</code>), usado para acrescentar pseudo-aleatoriedade &#224; gera&#231;&#227;o da nova linha.</p><p>Esta fun&#231;&#227;o pode ser definida da seguinte forma: </p><pre>estendeMapa (Mapa n l) seed = let ptv = proximosTerrenosValidos (Mapa n l)
                                  t0 = geraTerreno seed ptv
                                  va = if t0 == Rio 0 &amp;&amp; rioAnterior l then velocRioAnterior l
                                                                       else 0
                                  lvp = if va &lt; 0 then [0..(n-1)]
                                                  else if va &gt; 0 then [-(n-1)..0]
                                                                 else [-(n-1)..(n-1)]
                                  velocidade = geraVelocidade seed lvp
                                  terreno = adicionaVelocidade t0 velocidade
                                  obstaculos = geraObstaculo (gera seed n) n (terreno, [])
                              in Mapa n ((terreno, obstaculos):l)
</pre><p>Para esta fun&#231;&#227;o, vamos usar duas fun&#231;&#245;es auxiliares principais, a <code><a href="Tarefa2_2022li1g030.html#v:proximosTerrenosValidos" title="Tarefa2_2022li1g030">proximosTerrenosValidos</a></code> e a <code><a href="Tarefa2_2022li1g030.html#v:proximosObstaculosValidos" title="Tarefa2_2022li1g030">proximosObstaculosValidos</a></code>, e outras fun&#231;&#245;es auxiliares que a seguir se descrevem.</p></div></div><a href="#g:3" id="g:3"><h2>Fun&#231;&#245;es auxiliares</h2></a><div class="top"><p class="src"><a id="v:proximosTerrenosValidos" class="def">proximosTerrenosValidos</a> :: <a href="LI12223.html#t:Mapa" title="LI12223">Mapa</a> -&gt; [<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>] <a href="#v:proximosTerrenosValidos" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:proximosTerrenosValidos" title="Tarefa2_2022li1g030">proximosTerrenosValidos</a></code> devolve uma lista dos terrenos pass&#237;veis de ser utilizados numa pr&#243;xima linha do mapa, a partir de uma ou mais linhas anteriores.
Aqui podemos limitar a quantidade de terrenos cont&#237;guos de cada tipo, com um m&#225;ximo de 4 rios seguidos, e 5 estradas ou relvas seguidas.</p><pre>proximosTerrenosValidos (Mapa _ ((Rio _, _):(Rio _, _):(Rio _, _):(Rio _, _):t)) = [Estrada 0, Relva]
proximosTerrenosValidos (Mapa _ ((Estrada _, _):(Estrada _, _):(Estrada _, _):(Estrada _, _):(Estrada _, _):t)) = [Rio 0, Relva]
proximosTerrenosValidos (Mapa _ ((Relva, _):(Relva, _):(Relva, _):(Relva, _):(Relva, _):t)) = [Rio 0, Estrada 0]
proximosTerrenosValidos _ = [Rio 0, Estrada 0, Relva]
</pre></div></div><div class="top"><p class="src"><a id="v:geraTerreno" class="def">geraTerreno</a> :: Int -&gt; [<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>] -&gt; <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a> <a href="#v:geraTerreno" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraTerreno" title="Tarefa2_2022li1g030">geraTerreno</a></code> cria, com base em aleat&#243;rios devolvidos pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:gera" title="Tarefa2_2022li1g030">gera</a></code> e nas possibilidades oferecidas pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:proximosTerrenosValidos" title="Tarefa2_2022li1g030">proximosTerrenosValidos</a></code>, 
um terreno que ser&#225; utilizado numa pr&#243;xima linha do mapa.</p><pre>geraTerreno seed l = let rn = head (gera seed 1)
                         ri = mod rn (length l)
                     in l !! ri
</pre></div></div><div class="top"><p class="src"><a id="v:rioAnterior" class="def">rioAnterior</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; Bool <a href="#v:rioAnterior" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:rioAnterior" title="Tarefa2_2022li1g030">rioAnterior</a></code> ser&#225; usada na fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:estendeMapa" title="Tarefa2_2022li1g030">estendeMapa</a></code> para verificar, no caso de a fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraTerreno" title="Tarefa2_2022li1g030">geraTerreno</a></code> gerar Rio para a nova linha, se a linha pr&#233;via mais recente do mapa usa o terreno <code>Rio _</code>.</p><pre>rioAnterior ((Rio _,_):_) = True
rioAnterior _ = False
</pre></div></div><div class="top"><p class="src"><a id="v:velocRioAnterior" class="def">velocRioAnterior</a> :: [(<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>])] -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a> <a href="#v:velocRioAnterior" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:velocRioAnterior" title="Tarefa2_2022li1g030">velocRioAnterior</a></code> ser&#225; usada na fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:estendeMapa" title="Tarefa2_2022li1g030">estendeMapa</a></code> para, no caso de a fun&#231;&#227;o auxiliar <code><a href="Tarefa2_2022li1g030.html#v:rioAnterior" title="Tarefa2_2022li1g030">rioAnterior</a></code> devolver <code>True</code>, tomar a velocidade com que esse rio anterior se move. </p><pre>velocRioAnterior ((Rio v,_):_) = v
velocRioAnterior _ = 0
</pre></div></div><div class="top"><p class="src"><a id="v:geraVelocidade" class="def">geraVelocidade</a> :: Int -&gt; [<a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a>] -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a> <a href="#v:geraVelocidade" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraVelocidade" title="Tarefa2_2022li1g030">geraVelocidade</a></code> d&#225;, com base em aleat&#243;rios devolvidos pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:gera" title="Tarefa2_2022li1g030">gera</a></code>, uma velocidade que ser&#225; associada a um terreno numa pr&#243;xima linha do mapa.</p><p>No caso de a linha anterior usar um terreno <code>Rio</code> e de a <code><a href="Tarefa2_2022li1g030.html#v:geraTerreno" title="Tarefa2_2022li1g030">geraTerreno</a></code> ter atribu&#237;do igualmente um terreno <code>Rio</code> &#224; nova linha, com o aux&#237;lio das fun&#231;&#245;es <code><a href="Tarefa2_2022li1g030.html#v:rioAnterior" title="Tarefa2_2022li1g030">rioAnterior</a></code> e <code><a href="Tarefa2_2022li1g030.html#v:velocRioAnterior" title="Tarefa2_2022li1g030">velocRioAnterior</a></code>,
esta fun&#231;&#227;o ir&#225; atribuir velocidades de dire&#231;&#227;o oposta a rios cont&#237;guos.</p><pre>geraVelocidade seed l = let rn = head (gera seed 1)
                            ri = mod rn (length l)
                        in l !! ri
</pre></div></div><div class="top"><p class="src"><a id="v:adicionaVelocidade" class="def">adicionaVelocidade</a> :: <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a> -&gt; <a href="LI12223.html#t:Velocidade" title="LI12223">Velocidade</a> -&gt; <a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a> <a href="#v:adicionaVelocidade" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:adicionaVelocidade" title="Tarefa2_2022li1g030">adicionaVelocidade</a></code> associa a velocidade devolvida pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraVelocidade" title="Tarefa2_2022li1g030">geraVelocidade</a></code> ao terreno selecionado pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraTerreno" title="Tarefa2_2022li1g030">geraTerreno</a></code>.</p><pre>adicionaVelocidade (Rio _) v = Rio v
adicionaVelocidade (Estrada _) v = Estrada v
adicionaVelocidade Relva _ = Relva
</pre></div></div><div class="top"><p class="src"><a id="v:proximosObstaculosValidos" class="def">proximosObstaculosValidos</a> :: Int -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] <a href="#v:proximosObstaculosValidos" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:proximosObstaculosValidos" title="Tarefa2_2022li1g030">proximosObstaculosValidos</a></code> calcula que obst&#225;culos podem ser utilizados para preencher a lista de obst&#225;culos de uma pr&#243;xima linha do mapa, conforme o terreno gerado para a nova linha.</p><pre>proximosObstaculosValidos n (t,l)
    | length l &gt;= n = []
    | length l == (n-1) &amp;&amp; not (elem Nenhum l) = [Nenhum]
    | length l == (n-1) = case t of
                            (Rio _) -&gt; if not (elem Tronco l) then [Tronco]
                                                              else let inicio = contaExtremos l Tronco
                                                                       fim = contaExtremos (reverse l) Tronco  
                                                                   in if inicio + fim &lt; 5 then [Nenhum, Tronco]
                                                                                          else [Nenhum]
                            (Estrada _) -&gt; let inicio = contaExtremos l Carro
                                               fim = contaExtremos (reverse l) Carro  
                                           in if inicio + fim &lt; 3 then [Nenhum, Carro]
                                                                  else [Nenhum]
                            Relva -&gt; [Nenhum, Arvore]
    | otherwise = case t of
                    (Rio _) -&gt; let inicio = contaExtremos l Tronco
                               in if inicio &lt; 5 then [Nenhum, Tronco]
                                                else [Nenhum]
                    (Estrada _) -&gt; let inicio = contaExtremos l Carro
                                   in if inicio &lt; 3 then [Nenhum, Carro]
                                                    else [Nenhum]
                    Relva -&gt; [Nenhum, Arvore]
</pre></div></div><div class="top"><p class="src"><a id="v:contaExtremos" class="def">contaExtremos</a> :: [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] -&gt; <a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a> -&gt; Int <a href="#v:contaExtremos" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:contaExtremos" title="Tarefa2_2022li1g030">contaExtremos</a></code> &#233; uma fun&#231;&#227;o auxiliar da fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:proximosObstaculosValidos" title="Tarefa2_2022li1g030">proximosObstaculosValidos</a></code> criada para garantir que obst&#225;culos como <code>Tronco</code> e <code>Carro</code> n&#227;o ultrapassam o seu comprimento m&#225;ximo.</p><pre>contaExtremos [] _ = 0
contaExtremos (h:t) o = if h == o then 1 + contaExtremos t o 
                                  else 0
</pre></div></div><div class="top"><p class="src"><a id="v:geraObstaculo" class="def">geraObstaculo</a> :: [Int] -&gt; Int -&gt; (<a href="LI12223.html#t:Terreno" title="LI12223">Terreno</a>, [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>]) -&gt; [<a href="LI12223.html#t:Obstaculo" title="LI12223">Obstaculo</a>] <a href="#v:geraObstaculo" class="selflink">#</a></p><div class="doc"><p>A fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:geraObstaculo" title="Tarefa2_2022li1g030">geraObstaculo</a></code> d&#225;, com base em aleat&#243;rios devolvidos pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:gera" title="Tarefa2_2022li1g030">gera</a></code> e na lista de possibilidades criada pela fun&#231;&#227;o <code><a href="Tarefa2_2022li1g030.html#v:proximosObstaculosValidos" title="Tarefa2_2022li1g030">proximosObstaculosValidos</a></code>, 
uma lista de obst&#225;culos que ser&#225; usada numa pr&#243;xima linha do mapa. </p><pre>geraObstaculo [] _ _ = []
geraObstaculo (r:rs) n (t,lo)
    | length lo == n = []
    | otherwise = let pov = proximosObstaculosValidos n (t,lo)
                      po = mod r (length pov)
                  in (pov !! po) : geraObstaculo rs n (t,(pov !! po):lo)
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.23.0</p></div></body></html>